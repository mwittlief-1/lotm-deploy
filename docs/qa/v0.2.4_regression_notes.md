# v0.2.4 Regression Notes

**Last Updated:** 2026-02-16

## Summary

- **QA Gate:** CERTIFIABLE PASS (no-install flow)
- **Commands executed:** `npm run preflight`, `npm run qa`
- **Artifacts produced:**
  - `qa_artifacts/v0.2.4_preflight.json`
  - `qa_artifacts/v0.2.4_no_deps_gate.json`

## Determinism / Stability Observations

- v0.2.4 introduces a new deterministic RNG stream key **`court`** (officer generation). Static inspection confirms `StreamKey` includes `court` and the sim RNG implementation remains deterministic (no `Math.random()` in sim core).
- The no-deps QA gate and preflight both completed successfully, indicating:
  - deterministic replay hashes remain stable for the tested golden seeds/policies
  - invariants hold for the checked windows

## Invariants / Safety

- No-deps QA gate reports **7/7** checks passing, including invariants + bounded snapshot protections.
- Preflight reports **3/3** checks passing, including schema snapshot and a determinism smoke.

## Coverage Drift / Risks (non-blocking)

- **Golden seed file used:** the no-deps gate loaded `docs/golden_seeds_v0.2.1.json` (n=8).
  - This is acceptable for runtime sanity, but it weakens version-specific regression tracking for v0.2.4.
  - Recommendation: add `docs/golden_seeds_v0.2.4.json` (or update the loader priority) so v0.2.4 has pinned seed expectations.

## sim_version Freshness

- `docs/BUILD_INFO.json.sim_version = mvp_v0_1` matches `src/sim/version.ts`.
  - No evidence of a stale sim_version label for v0.2.4.

## Follow-up Test Suggestions (non-balance)

Given v0.2.4â€™s scope (court roster + consumption reconciliation + marriage roster update), consider adding/expanding invariant assertions to explicitly cover:

- **Court headcount derivation** never negative; matches court roster cardinality.
- **Consumption split math**: the same bushel pool is not double-counted across peasant vs court consumption.
- **Marriage roster update**: spouse addition to court roster is deterministic and cannot produce duplicate people ids.
