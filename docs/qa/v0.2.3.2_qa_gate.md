# v0.2.3.2 QA Gate

**Date (UTC):** 2026-02-16  \
**Gate Owner:** QA Engineer

## Build Identity

From `docs/BUILD_INFO.json`:

- **app_version:** v0.2.3.2
- **sim_version (BUILD_INFO):** mvp_v0_1
- **code_fingerprint:** efe80b576695d1377e6a6210dcfee19bf5446ee81988374dae2098117919e6bf

## Verdict

✅ **CERTIFIABLE PASS**

Certifiable because the authoritative gate commands executed successfully in a **no `node_modules/`** environment via the intended **no-deps** paths, and wrote machine-readable artifacts to `qa_artifacts/`.

## Commands Executed (authoritative)

From repo root (no install):

```bash
npm run preflight
npm run qa
```

### Observed Output

Preflight:
- `preflight: PASS (passed 3/3)`

QA:
- `Vitest not found (node_modules missing). Running no-deps QA gate...`
- `qa_no_deps: PASS (passed 7/7)`

**Exit code(s):** 0

## Machine-Readable Artifacts (required)

- `qa_artifacts/v0.2.3.2_preflight.json` (PASS, 3/3)
- `qa_artifacts/v0.2.3.2_no_deps_gate.json` (PASS, 7/7)

## Coverage Summary

### Preflight Gate (`npm run preflight`)
Implements the minimum contract checks for the Prospects MVP:

1) ProspectsWindow schema snapshot (v1)
2) Determinism smoke (same seed + same decisions ⇒ identical ProspectsWindow ids + fields)
3) Non-perturbation when no prospects accepted

### QA Gate (`npm run qa` → no-deps)
Validated (via `scripts/qaNoDeps.mjs`):

1) Determinism (same seed + same policy ⇒ identical logs)
2) Golden seed regression (15 turns) — invariants pass
   - `prudent-builder` (first 8 golden seeds)
   - `builder-forward` (first 8 golden seeds)
3) Invariants / clamps
   - No NaN/Infinity
   - `0 ≤ unrest ≤ 100`
   - Relationships `A/R/T` clamped to `0..100`
   - `energy.available/max ≥ 0` and `available ≤ max`
   - Non-negative stored resources + arrears
   - Labor allocation `farmers + builders ≤ population`
   - Game-over reasons restricted to allowed set (`Dispossessed`, `DeathNoHeir`)
4) Bounded snapshots
   - Snapshots do not contain `log` and only include an allowed key set
5) Policy registry drift checks
   - `docs/BUILD_INFO.json.policy_ids` matches `POLICY_IDS`
6) Policy behavior sanity
   - `builder-forward` starts with `field_rotation` when viable
7) Back-compat smoke (fixture)
   - v0.1.0 fixture can be proposed/migrated by `proposeTurn()` without crashing

## BUILD_INFO.sim_version freshness check

`docs/BUILD_INFO.json.sim_version = "mvp_v0_1"` matches `src/sim/version.ts` and the compiled sim under `dist_batch/`. This appears **intentional** for v0.2.3.2 (not stale).

## Notes / Known Gaps (non-blocking)

- The no-deps QA gate loaded golden seeds from `docs/golden_seeds_v0.2.1.json` (see `qa_artifacts/v0.2.3.2_no_deps_gate.json.notes`).
  - v0.2.3.2 does not ship `docs/golden_seeds_v0.2.3.2.json`, so the current candidate list falls back to v0.2.1.
  - Repo does contain `docs/golden_seeds_v0.2.3.json`; if v0.2.3.2 is intended to inherit the most recent seed suite, update the seed selection logic (or add a version-matched seeds file) so the gate uses v0.2.3 rather than v0.2.1.
