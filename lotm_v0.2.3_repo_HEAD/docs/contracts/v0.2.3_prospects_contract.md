# v0.2.3 Prospects Contract — LOCKED (prospects_window_v1)
**Last Updated:** 2026-02-14  
**Owners:** CPO (product locks), CTO (engineering contract)

## Locked decisions
- v0.2.3 includes deterministic **Prospects MVP** + **relevance filtering (presentation-only)**.
- Info-cost (pay energy/coin to reveal) is deferred to later v0.2.x.
- Prospects per window are **bounded N ≤ 3** (LOCKED for v0.2.3).
- Prospects generation uses dedicated RNG stream key: `prospects` (and must not perturb existing sim streams).
- Relevance filtering produces `shown_ids`/`hidden_ids` deterministically and logs both.

---

## ProspectsWindow schema — LOCK (`schema_version = "prospects_window_v1"`)

### ProspectsWindow
- `schema_version`: `"prospects_window_v1"`
- `turn_index`: number
- `generated_at_turn_index`: number
- `prospects`: `Prospect[]` *(bounded N ≤ 3)*
- `shown_ids`: `string[]`
- `hidden_ids`: `string[]`

### Prospect (v1)
- `id`: string *(deterministic)*
- `type`: `"marriage" | "grant" | "inheritance_claim"`
- `from_house_id`: string
- `to_house_id`: string *(player house)*
- `subject_person_id`: string | null *(required for marriage; optional otherwise)*
- `summary`: string *(1-line)*
- `requirements`: `Requirement[]`
- `costs`: `{ coin?: number; energy?: number; bushels?: number }`
- `predicted_effects`: `{ coin_delta?: number; relationship_deltas?: RelationshipDelta[]; flags_set?: string[] }`
- `uncertainty`: `"known" | "likely" | "possible"`
- `expires_turn`: number
- `actions`: `("accept" | "reject")[]` *(v0.2.3 only)*

### Requirement
- `kind`: `"respect_min" | "allegiance_min" | "threat_max" | "coin_min" | "no_arrears" | "custom"`
- `value`: number | string | boolean
- `text`: string *(human-readable)*

### RelationshipDelta
- `scope`: `"person" | "house"` *(v0.2.3 can be person-only)*
- `from_id`: string
- `to_id`: string
- `allegiance_delta`: number
- `respect_delta`: number
- `threat_delta`: number

---

## Required log events — LOCK (exact names)
Events must appear in the turn log:

- `prospect_generated` *(one per generated prospect)*
- `prospects_window_built` *(once per turn if any prospects generated; includes shown_ids/hidden_ids)*
- `prospect_accepted`
- `prospect_rejected`
- `prospect_expired`

Each must include:
- `turn_index`
- `type`
- `from_house_id`, `to_house_id`
- `subject_person_id` when applicable
- `effects_applied` summary on accept/reject/expire *(coin delta + relationship deltas + flags set)*
- `prospect_id` *(except `prospects_window_built`)*

---

## Prospect types in MVP — LOCK
v0.2.3 includes exactly:
1) Marriage (full)
2) Grant (full)
3) Inheritance_claim (claim-only; **no holdings granted**)

Inheritance_claim effects are limited to:
- relationship deltas and/or flags (e.g., `inheritance_claim_active`)
- optional future metadata (chance/strength)
- no new holdings in v0.2.3

---

## Relevance filtering behavior — LOCK (presentation-only)
Sim generates ProspectsWindow deterministically (N ≤ 3). UI surfaces a subset deterministically.
No mechanic cost to reveal hidden items in v0.2.3.

Relevance rule (v0.2.3 lock):
Show a prospect if:
- it directly involves a player household person, OR
- originating house relationship strength meets threshold (implement as Respect≥X or Allegiance≥X), OR
- it expires this turn (avoid silent expiration)

Anything else may be generated but hidden and logged.

---

## Preflight tests — LOCK (minimum set)
- Schema snapshot: ProspectsWindow matches `schema_version="prospects_window_v1"`
- Determinism smoke: same seed + same decisions ⇒ same ProspectsWindow (ids + fields)
- Non-perturbation: if no prospects accepted, core economic outputs unchanged vs baseline for golden seeds
