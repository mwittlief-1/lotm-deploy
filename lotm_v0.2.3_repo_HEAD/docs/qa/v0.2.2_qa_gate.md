# v0.2.2 QA Gate

**Date (UTC):** 2026-02-14  
**Gate Owner:** QA Engineer  

## Build Identity

- **app_version:** v0.2.2
- **sim_version (BUILD_INFO):** mvp_v0_1
- **code_fingerprint:** edf67fcfbbac7a3c2b368c43fd7f8c26a01be39fc69fbc3bb70ecaa4b75f10d5

## Verdict

✅ **CERTIFIABLE PASS**

Certifiable because the authoritative gate command (`npm run qa`) executed successfully in a **no `node_modules/`** environment via the intended no-deps fallback and wrote machine-readable artifacts to `qa_artifacts/`.

## Commands Executed (authoritative)

From repo root (no install):

```bash
npm run qa
```

### Observed Output

- `Vitest not found (node_modules missing). Running no-deps QA gate...`
- `qa_no_deps: PASS (passed 7/7)`

**Exit code:** 0

## Machine-Readable Artifacts (required)

- `qa_artifacts/v0.2.2_no_deps_gate.json` (PASS, 7/7)

## External Houses Smoke Check (TA-critical)

In addition to the gate, I ran a targeted smoke check on the external-world seed + non-destructive People-First sync:

- Seed: `lotm_v022_seed_001_baseline_extworld`
- After `createNewRun(seed)`:
  - External houses present: **9** (`h_ext_01..h_ext_09`)
  - External people present: **29** (`p_ext_*`)
  - Idempotence flag present: `state.flags._worldgen_external_houses_v0_2_2 === true`
- After 1 turn under `prudent-builder`:
  - External house key set **unchanged**
  - External people key set **unchanged**

This directly validates the two highest-risk v0.2.2 items from TA/CTO notes:
- external world seeding occurs
- `ensurePeopleFirst()` sync does **not** wipe external registries

## Coverage Summary (what the gate validated)

The no-deps gate (executed via `scripts/qaNoDeps.mjs`) validated:

1) **Determinism (same seed + same policy ⇒ identical logs)**
2) **Golden seed regression (15 turns) — invariants pass**
   - `prudent-builder` (first 8 golden seeds)
   - `builder-forward` (first 8 golden seeds)
3) **Invariants / clamps**
   - No NaN/Infinity
   - `0 ≤ unrest ≤ 100`
   - Relationships `A/R/T` clamped to `0..100`
   - `energy.available/max ≥ 0` and `available ≤ max`
   - Non-negative stored resources + arrears
   - Labor allocation `farmers + builders ≤ population`
   - Game-over reasons restricted to allowed set (`Dispossessed`, `DeathNoHeir`)
4) **Bounded snapshots**
   - Snapshots do not contain `log` and only include an allowed key set
5) **Policy registry drift checks**
   - `docs/BUILD_INFO.json.policy_ids` must match `POLICY_IDS` and sanitization rules
6) **Policy behavior sanity**
   - `builder-forward` starts with `field_rotation` when viable
7) **Back-compat smoke (fixture)**
   - v0.1.0 fixture can be proposed/migrated by `proposeTurn()` without crashing

## BUILD_INFO.sim_version freshness check

`docs/BUILD_INFO.json.sim_version = "mvp_v0_1"` matches `src/sim/version.ts` (`SIM_VERSION = "mvp_v0_1"`). This appears **intentional** for v0.2.2 (not stale).

## Notes / Known Gaps (non-blocking)

- Gate validates determinism **within v0.2.2** (same seed/policy ⇒ identical logs), but does not currently include a stored prior-version hash sentinel to prove “worldgen does not perturb existing streams” across versions.
  - If you want that guarantee in CI, add 1–2 drift sentinel seeds with stored expected hashes for the pre-worldgen-dependent portions of the log/state.
